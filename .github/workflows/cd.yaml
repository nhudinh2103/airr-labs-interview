# name: CD

# on:
#   workflow_run:
#     workflows: ["CI"]
#     types:
#       - completed
#     branches: [main]

# jobs:
#   deploy:
#     # Only run if CI workflow succeeded
#     if: ${{ github.event.workflow_run.conclusion == 'success' }}
#     runs-on: ubuntu-latest
#     steps:
#       - name: Login to GCR
#         uses: docker/login-action@v3
#         with:
#           registry: asia.gcr.io
#           username: _json_key
#           password: ${{ secrets.AIRR_LABS_GCP_SA_KEY }}
      
#       - uses: actions/checkout@v2

#       - name: Set up Cloud SDK
#         uses: google-github-actions/setup-gcloud@v0
#         with:
#           project_id: ${{ secrets.AIRR_LABS_GCP_PROJECT_ID }}
#           service_account_key: ${{ secrets.AIRR_LABS_GCP_SA_KEY }}
#           export_default_credentials: true

#       - name: Deploy to Cloud Composer
#         run: |
#           # Get Composer's GCS bucket
#           COMPOSER_BUCKET=$(gcloud composer environments describe ${{ secrets.AIRR_LABS_COMPOSER_ENV_NAME }} \
#             --location=${{ secrets.AIRR_LABS_COMPOSER_LOCATION }} \
#             --format="get(config.dagGcsPrefix)")
          
#           # Sync DAGs
#           gsutil -m rsync -r dags/ $COMPOSER_BUCKET/dags
          
#           # Sync plugins
#           gsutil -m rsync -r plugins/ $COMPOSER_BUCKET/plugins
          
#           echo "Deployment completed successfully"
